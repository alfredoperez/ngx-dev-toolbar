---
interface Props {
  filename?: string;
  description?: string;
}

const { filename, description } = Astro.props;
---

<div class="code-block group relative my-6 rounded-lg border border-gray-700/50 bg-surface-2 overflow-hidden">
  {filename && (
    <div class="flex items-center justify-between border-b border-gray-700/50 bg-surface-3 px-4 py-2">
      <span class="text-xs font-mono text-gray-400">{filename}</span>
      <button
        class="copy-btn opacity-0 group-hover:opacity-100 transition-opacity text-xs text-gray-400 hover:text-white px-2 py-1 rounded bg-surface-4 hover:bg-brand-600"
        aria-label="Copy code"
      >
        Copy
      </button>
    </div>
  )}
  {!filename && (
    <button
      class="copy-btn absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity text-xs text-gray-400 hover:text-white px-2 py-1 rounded bg-surface-4 hover:bg-brand-600 z-10"
      aria-label="Copy code"
    >
      Copy
    </button>
  )}
  {description && (
    <div class="px-4 pt-3 text-sm text-gray-400">
      {description}
    </div>
  )}
  <div class="overflow-x-auto [&_pre]:!m-0 [&_pre]:!rounded-none [&_pre]:!border-0 [&_pre]:!bg-transparent [&_pre]:p-4">
    <slot />
  </div>
</div>

<script>
  document.querySelectorAll('.copy-btn').forEach((btn) => {
    btn.addEventListener('click', async () => {
      const block = btn.closest('.code-block');
      const code = block?.querySelector('code')?.textContent || '';
      try {
        await navigator.clipboard.writeText(code);
        const original = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => { btn.textContent = original; }, 2000);
      } catch {
        // Fallback for older browsers
      }
    });
  });
</script>
